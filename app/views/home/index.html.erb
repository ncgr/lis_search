<%= form_tag("/search", :method => "get", :remote => true, :id => "search") do %>
  <%= text_field_tag(:q, nil, :placeholder => "Keyword search...") %>
  <%= submit_tag("Search") %>
<% end %>

<div id="results-empty"></div>
<div id="results">
  <div id="results-menu">
    <span id="menu-loading">
      <p>Searching... <img src="/assets/loading.gif" alt="Searching" /></p>
    </span>
    <span id="tools">
      <button id='partition' disabled="disabled">partition view</button>
      <button id='table'>table view</button>
    </span>
  </div>
  <div id="search-results"></div>
</div>

<script type="text/template" id="table-view">
  <table>
    <tr>
      <th>QTL</th>
      <th>Linkage Group</th>
      <th>Start</th>
      <th>Stop</th>
      <th>Species</th>
    </tr>
  {{ _.each(data, function(d) { }}
    {{ var url = urls[d.species] + d.qtl_name }}
    <tr>
      <td><a href="{{= url }}" target="_blank">{{= d.qtl_name }}</a></td>
      <td>{{= d.lg }}</td>
      <td>{{= d.left_end }}</td>
      <td>{{= d.right_end }}</td>
      <td>{{= d.species }}</td>
    </tr>
  {{ }); }}
  </table>
</script>

<script type="text/javascript">
$(function() {

  _.each(["#results-menu", "#tools"], function(e) { $(e).hide(); });
  $("button", "#results-menu").button();

  // Disable the selected view.
  var disableView = function(el) {
    $("#tools button").each(function() {
      $(this).removeAttr("disabled");
    });
    $(el).attr("disabled", "disabled");
  };

  // View as table
  $("#table").click(function() {
    LKS.renderTable(null);
    disableView("#table");
  });

  // View as partition
  $("#partition").click(function() {
    LKS.renderPartition(null);
    disableView("#partition");
  });

  $("#search").on("submit", function() {
    $("#results-menu").show();
    $("#menu-loading").show();
  });

  $("#search").on("ajax:success", function(e, d, s) {
    LKS.collectResults(d);
  });

});
</script>
